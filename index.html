<!DOCTYPE html>
<html lang="ko" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artb (ì•„íŠ¸ë¹„) - AIì™€ ì „ë¬¸ê°€ê°€ í•¨ê»˜í•˜ëŠ” ìƒˆë¡œìš´ ë¯¸ìˆ  êµìœ¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard@1.3.8/dist/web/static/pretendard.css">
    <!-- OpenCVëŠ” WebWorkerì—ì„œ importScriptsë¡œ ë¡œë“œí•˜ë¯€ë¡œ ì´ í˜ì´ì§€ì— ì§ì ‘ ë¡œë“œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. -->
    <style>
        body { font-family: 'Pretendard', sans-serif; }
        .hero-gradient { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); }
        .info-box { background-color: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 1rem; margin-bottom: 1rem; border-radius: 0.5rem; }
        .feature-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .demo-container {
            position: relative;
            overflow: hidden;
            background-color: #000;
        }
        #canvasOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        /* íŒì—… ë° ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            max-width: 90%;
            width: 600px;
        }
        .progress-step {
            display: flex;
            align-items: center;
            opacity: 0.5;
            transition: opacity 0.3s ease-in-out;
        }
        .progress-step.active {
            opacity: 1;
        }
        .progress-step .icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 1rem;
            transition: background-color 0.3s, color 0.3s;
        }
        .progress-step.pending .icon { background-color: #e5e7eb; color: #6b7280; }
        .progress-step.active .icon { background-color: #4f46e5; color: white; }
        .progress-step.completed .icon { background-color: #10b981; color: white; }
        
        /* í”¼ë“œë°± ì„œì‹ ìŠ¤íƒ€ì¼ */
        .feedback-section h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e3a8a; /* A darker blue */
            margin-bottom: 0.5rem;
            padding-bottom: 0.25rem;
            border-bottom: 1px solid #ddd;
        }
        .feedback-section p {
            color: #4b5563;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-lg fixed top-0 left-0 right-0 z-40 shadow-sm">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <a href="#" class="text-2xl font-bold text-indigo-600">Artb</a>
                </div>
                <!-- Desktop Navigation -->
                <nav class="hidden md:flex md:items-center md:space-x-8">
                    <a href="#features" class="text-gray-600 hover:text-indigo-600 transition">ì£¼ìš” ê¸°ëŠ¥</a>
                    <a href="#demo" class="text-gray-600 hover:text-indigo-600 transition">ë°ëª¨ ì²´í—˜</a>
                    <a href="#survey" class="text-gray-600 hover:text-indigo-600 transition">ì„¤ë¬¸ì¡°ì‚¬</a>
                    <a href="#contact" class="text-gray-600 hover:text-indigo-600 transition">ë¬¸ì˜í•˜ê¸°</a>
                    <a href="#cta" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition">ì‚¬ì „ ë“±ë¡</a>
                </nav>
                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="p-2 rounded-md text-gray-600 hover:text-indigo-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#features" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-indigo-600 hover:bg-gray-50 mobile-menu-link">ì£¼ìš” ê¸°ëŠ¥</a>
                <a href="#demo" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-indigo-600 hover:bg-gray-50 mobile-menu-link">ë°ëª¨ ì²´í—˜</a>
                <a href="#survey" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-indigo-600 hover:bg-gray-50 mobile-menu-link">ì„¤ë¬¸ì¡°ì‚¬</a>
                <a href="#contact" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-indigo-600 hover:bg-gray-50 mobile-menu-link">ë¬¸ì˜í•˜ê¸°</a>
                <a href="#cta" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-indigo-600 hover:bg-gray-50 mobile-menu-link">ì‚¬ì „ ë“±ë¡</a>
            </div>
        </div>
    </header>

    <main class="pt-16">
        <!-- Hero Section -->
        <section class="hero-gradient py-20 sm:py-32">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold text-gray-900 leading-tight">
                    AIì™€ ì§„ì§œ ì „ë¬¸ê°€ê°€ ë§Œë‚˜ëŠ” ê³³,<br class="hidden sm:block"> ë‹¹ì‹ ì˜ ì ì¬ë ¥ì„ ê¹¨ìš°ëŠ” ì‹œê°„
                </h1>
                <p class="mt-6 max-w-2xl mx-auto text-lg text-gray-600">
                    ArtbëŠ” ë‹¹ì‹ ì˜ ê·¸ë¦¼ì„ AIë¡œ ì¦‰ì‹œ ë¶„ì„í•˜ê³ , í˜„ì§ ì‘ê°€ì˜ ê¹Šì´ ìˆëŠ” í”¼ë“œë°±ì„ ë”í•´ì¤ë‹ˆë‹¤. ì´ì œ ì‹œê°„ê³¼ ì¥ì†Œì— êµ¬ì• ë°›ì§€ ë§ê³  ìµœê³ ì˜ ë¯¸ìˆ  êµìœ¡ì„ ê²½í—˜í•˜ì„¸ìš”.
                </p>
                <div class="mt-10">
                    <a href="#demo" class="bg-indigo-600 text-white font-bold py-3 px-6 sm:px-8 rounded-full text-lg hover:bg-indigo-700 transition transform hover:scale-105">ì§€ê¸ˆ ë°”ë¡œ ë°ëª¨ ì²´í—˜í•˜ê¸°</a>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="py-20 bg-white">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold">ë¬´ì—‡ì´ Artbë¥¼ íŠ¹ë³„í•˜ê²Œ ë§Œë“œë‚˜ìš”?</h2>
                    <p class="text-gray-600 mt-2">ArtbëŠ” ê¸°ìˆ ê³¼ ì‚¬ëŒì˜ ì˜¨ê¸°ë¥¼ ê²°í•©í•˜ì—¬ ìµœìƒì˜ í•™ìŠµ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
                </div>
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="text-center p-6 border border-gray-200 rounded-lg hover:shadow-xl transition">
                         <div class="flex items-center justify-center h-16 w-16 rounded-full feature-icon mx-auto mb-4 text-white">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">AI ì¦‰ê° í”¼ë“œë°±</h3>
                        <p class="text-gray-600">ê·¸ë¦¼ì„ ì œì¶œí•˜ëŠ” ì¦‰ì‹œ AIê°€ êµ¬ë„, ëª…ì•”, ë¹„ìœ¨ì„ ë¶„ì„í•´ ê¸°ì´ˆë¥¼ íƒ„íƒ„í•˜ê²Œ ì¡ì•„ì¤ë‹ˆë‹¤.</p>
                    </div>
                    <div class="text-center p-6 border border-gray-200 rounded-lg hover:shadow-xl transition">
                        <div class="flex items-center justify-center h-16 w-16 rounded-full feature-icon mx-auto mb-4 text-white">
                           <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">ì „ë¬¸ê°€ ìµœì¢… í”¼ë“œë°±</h3>
                        <p class="text-gray-600">AI ë¶„ì„ì„ ë°”íƒ•ìœ¼ë¡œ í˜„ì§ ì‘ê°€ë“¤ì´ ì°½ì˜ì„±ê³¼ í‘œí˜„ë ¥ ë“± ê¹Šì´ ìˆëŠ” ë©˜í† ë§ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
                    </div>
                    <div class="text-center p-6 border border-gray-200 rounded-lg hover:shadow-xl transition">
                        <div class="flex items-center justify-center h-16 w-16 rounded-full feature-icon mx-auto mb-4 text-white">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">ë””ì§€í„¸ í¬íŠ¸í´ë¦¬ì˜¤</h3>
                        <p class="text-gray-600">ëª¨ë“  ê·¸ë¦¼ê³¼ í”¼ë“œë°±ì´ ìë™ìœ¼ë¡œ ê¸°ë¡ë˜ì–´, ë‚˜ì˜ ì„±ì¥ ê³¼ì •ì„ í•œëˆˆì— ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </section>


        <!-- Demo Section -->
        <section id="demo" class="py-20 bg-gray-100">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold">ë°±ë¬¸ì´ ë¶ˆì—¬ì¼ê²¬, ì§ì ‘ ê²½í—˜í•´ë³´ì„¸ìš”</h2>
                    <p class="text-gray-600 mt-2">Artbì˜ ë†€ë¼ìš´ ì´ë¯¸ì§€ ì²˜ë¦¬ ê¸°ìˆ ê³¼ AI í”¼ë“œë°±ì„ ì²´í—˜í•´ë³´ì„¸ìš”.</p>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <div id="ui-section" class="space-y-4">
                        <button id="startCameraButton" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition text-lg">ì¹´ë©”ë¼ë¡œ ì‘í’ˆ ì´¬ì˜í•˜ê¸°</button>
                        <!-- ëª¨ë°”ì¼ ì¹´ë©”ë¼ í˜¸ì¶œ ì§€ì›ì„ ìœ„í•´ capture ì†ì„± í¬í•¨ -->
                        <button id="uploadImageButton" class="w-full bg-slate-700 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-800 transition text-lg">ì´ë¯¸ì§€ ì—…ë¡œë“œí•˜ê¸°</button>
                    </div>
                    <!-- ë“œë¡­ì¡´: ë°ìŠ¤í¬í†± ìš°ì„ , ëª¨ë°”ì¼ì€ ë²„íŠ¼ ì‚¬ìš© ê¶Œì¥ -->
                    <div id="dropzone" class="dropzone rounded-lg p-6 text-center text-slate-600">
                        <p class="font-semibold">ì—¬ê¸°ì— ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•˜ê±°ë‚˜, ìœ„ì˜ "ì´ë¯¸ì§€ ì—…ë¡œë“œí•˜ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</p>
                        <p class="text-sm mt-1">ì§€ì› í˜•ì‹: JPG, PNG, WEBP (HEIC/HEIFëŠ” ë¸Œë¼ìš°ì € ì§€ì› í•„ìš”)</p>
                    </div>

                    <!-- ìˆ¨ê¹€ íŒŒì¼ ì…ë ¥ (ëª¨ë°”ì¼ & ë°ìŠ¤í¬í†± ê³µìš©) -->
                    <input id="imageFileInput" class="hidden" type="file" accept="image/*" />

                    <div id="camera-view" class="hidden relative demo-container rounded-lg">
                        <video id="videoElement" class="w-full h-full" autoplay playsinline></video>
                        <canvas id="canvasOverlay"></canvas>
                        <div class="absolute bottom-4 left-4 right-4 grid grid-cols-1 md:grid-cols-2 gap-2">
                            <button id="captureButton" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition text-lg">ì´¬ì˜í•˜ê¸°</button>
                            <button id="closeCameraButton" class="w-full bg-gray-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-600 transition text-lg">ë‹«ê¸°</button>
                        </div>
                    </div>
                    <p id="camera-error" class="hidden text-center text-red-500 p-2 bg-red-50 rounded-md"></p>
                    
                    <div id="result-section" class="hidden mt-6 p-4 border rounded-lg bg-gray-50">
                        <h3 class="text-xl font-semibold mb-4">ìµœì¢… ë¶„ì„ ê²°ê³¼</h3>
                        <img id="processedImage" class="w-full rounded-lg mb-4 border" alt="ë³´ì •ëœ ì´ë¯¸ì§€">
                        <div id="ai-feedback" class="info-box">
                            <p class="font-bold text-sky-800">ğŸ¤– AI 1ì°¨ í”¼ë“œë°±</p>
                            <div id="ai-feedback-text" class="space-y-4"></div>
                        </div>
                        <div id="expert-feedback-info" class="info-box bg-emerald-50 border-emerald-400">
                            <p class="font-bold text-emerald-800">ğŸ‘©â€ğŸ« ì „ë¬¸ê°€ ìµœì¢… í”¼ë“œë°±</p>
                            <p>ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” 24ì‹œê°„ ë‚´ì— ì „ë¬¸ê°€ì˜ ê¹Šì´ ìˆëŠ” í”¼ë“œë°±ì´ ì´ ê³³ì— í‘œì‹œë©ë‹ˆë‹¤!</p>
                        </div>
                        <!-- AI Style Analysis Feature -->
                        <div id="style-analysis-container" class="mt-4">
                            <button id="styleAnalysisButton" class="w-full bg-purple-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-700 transition text-lg">âœ¨ ë‚´ ê·¸ë¦¼ ìŠ¤íƒ€ì¼ ë¶„ì„í•˜ê¸°</button>
                            <div id="style-loading" class="hidden text-center p-4">
                                <p>AIê°€ ì‘í’ˆì˜ ìŠ¤íƒ€ì¼ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
                            </div>
                            <div id="style-result" class="hidden mt-4 info-box bg-purple-50 border-purple-400">
                                <p class="font-bold text-purple-800">ğŸ¨ AI ìŠ¤íƒ€ì¼ ë¶„ì„</p>
                                <div id="style-result-text" class="space-y-4"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Survey Section -->
        <section id="survey" class="py-20 bg-white">
            <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold">ë” ë‚˜ì€ Artbë¥¼ ìœ„í•´, ë‹¹ì‹ ì˜ ëª©ì†Œë¦¬ë¥¼ ë“¤ë ¤ì£¼ì„¸ìš”</h2>
                    <p class="text-gray-600 mt-2">ì ê¹ì˜ ì‹œê°„ì´ Artbë¥¼ ë°œì „ì‹œí‚¤ëŠ” í° í˜ì´ ë©ë‹ˆë‹¤.</p>
                </div>
                <div id="survey-container" class="bg-white p-8 rounded-lg shadow-lg border border-gray-200">
                    <form id="artb-survey-form" class="space-y-6">
                        <div>
                            <label class="block text-lg font-semibold text-gray-700">1. ë‹¹ì‹ ì€ ëˆ„êµ¬ì‹ ê°€ìš”?</label>
                            <div class="mt-2 space-y-2">
                                <label class="flex items-center">
                                    <input type="radio" name="role" value="artist_instructor" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300" required>
                                    <span class="ml-3 text-gray-700">í˜„ì§ ì‘ê°€ ë˜ëŠ” ë¯¸ìˆ  ê°•ì‚¬</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="role" value="student_parent" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                                    <span class="ml-3 text-gray-700">í•™ìƒ ë˜ëŠ” í•™ë¶€ëª¨</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="role" value="hobbyist" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                                    <span class="ml-3 text-gray-700">ë¯¸ìˆ ì— ê´€ì‹¬ìˆëŠ” ì¼ë°˜ì¸</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="role" value="other" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                                    <span class="ml-3 text-gray-700">ê¸°íƒ€</span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-lg font-semibold text-gray-700">2. Artb ì„œë¹„ìŠ¤ì—ì„œ ê°€ì¥ ê¸°ëŒ€ë˜ëŠ” ê¸°ëŠ¥ì€ ë¬´ì—‡ì¸ê°€ìš”? (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)</label>
                            <div class="mt-2 space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" name="interest" value="ai_feedback" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded">
                                    <span class="ml-3 text-gray-700">AI ìë™ í”¼ë“œë°±</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="interest" value="expert_feedback" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded">
                                    <span class="ml-3 text-gray-700">ì „ë¬¸ê°€ 1:1 í”¼ë“œë°±</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="interest" value="local_content" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded">
                                    <span class="ml-3 text-gray-700">ìš°ë¦¬ ì§€ì—­ ì‘ê°€ ì½˜í…ì¸ </span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="interest" value="portfolio" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded">
                                    <span class="ml-3 text-gray-700">ë””ì§€í„¸ í¬íŠ¸í´ë¦¬ì˜¤</span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label for="feedback-text" class="block text-lg font-semibold text-gray-700">3. Artbì— ë°”ë¼ëŠ” ì ì´ë‚˜ ê¶ê¸ˆí•œ ì ì„ ììœ ë¡­ê²Œ ë‚¨ê²¨ì£¼ì„¸ìš”.</label>
                            <div class="mt-2">
                                <textarea id="feedback-text" name="feedback_text" rows="4" class="shadow-sm block w-full focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border border-gray-300 rounded-md p-2"></textarea>
                            </div>
                        </div>
                        <div>
                            <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition text-lg">ì˜ê²¬ ì œì¶œí•˜ê¸°</button>
                        </div>
                    </form>
                </div>
                <div id="survey-thanks" class="hidden text-center bg-emerald-100 p-8 rounded-lg border border-emerald-300">
                    <h3 class="text-2xl font-bold text-emerald-800">ì†Œì¤‘í•œ ì˜ê²¬ ê°ì‚¬í•©ë‹ˆë‹¤!</h3>
                    <p class="mt-2 text-emerald-700">ë³´ë‚´ì£¼ì‹  ì˜ê²¬ì„ ë°”íƒ•ìœ¼ë¡œ ë” ë‚˜ì€ Artbë¥¼ ë§Œë“¤ì–´ê°€ê² ìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </section>
        
        <section id="contact" class="py-20 bg-gray-100">
            <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
                 <div class="text-center mb-12">
                    <h2 class="text-3í™” font-bold">ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹ ê°€ìš”?</h2>
                    <p class="text-gray-600 mt-2">íŒŒíŠ¸ë„ˆì‹­ ì œíœ´, íˆ¬ì ë¬¸ì˜ ë“± ì–´ë–¤ ë‚´ìš©ì´ë“  í¸í•˜ê²Œ ì—°ë½ì£¼ì„¸ìš”.</p>
                </div>
                <div id="contact-container" class="bg-white p-8 rounded-lg shadow-lg border border-gray-200">
                    <form id="contact-form" class="space-y-6">
                        <div>
                            <label for="contact-name" class="block text-lg font-semibold text-gray-700">ì´ë¦„</label>
                            <input type="text" id="contact-name" name="name" class="mt-2 shadow-sm block w-full focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border border-gray-300 rounded-md p-2" required>
                        </div>
                         <div>
                            <label for="contact-email" class="block text-lg font-semibold text-gray-700">ì´ë©”ì¼</label>
                            <input type="email" id="contact-email" name="email" class="mt-2 shadow-sm block w-full focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border border-gray-300 rounded-md p-2" required>
                        </div>
                        <div>
                            <label for="contact-message" class="block text-lg font-semibold text-gray-700">ë¬¸ì˜ ë‚´ìš©</label>
                            <textarea id="contact-message" name="message" rows="4" class="mt-2 shadow-sm block w-full focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border border-gray-300 rounded-md p-2" required></textarea>
                        </div>
                        <div>
                            <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition text-lg">ë¬¸ì˜ ë³´ë‚´ê¸°</button>
                        </div>
                    </form>
                </div>
                 <div id="contact-thanks" class="hidden text-center bg-emerald-100 p-8 rounded-lg border border-emerald-300">
                    <h3 class="text-2xl font-bold text-emerald-800">ë¬¸ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤.</h3>
                    <p class="mt-2 text-emerald-700">ê²€í†  í›„ ë‚¨ê²¨ì£¼ì‹  ì´ë©”ì¼ë¡œ ë¹ ë¥´ê²Œ íšŒì‹ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </section>
        
        <section id="cta" class="py-20 bg-white">
            <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                 <div id="cta-container">
                    <h2 class="text-3xl font-bold">ìƒˆë¡œìš´ ë¯¸ìˆ  êµìœ¡ì˜ ì‹œì‘,<br>ì²« ë²ˆì§¸ ì£¼ì¸ê³µì´ ë˜ì–´ì£¼ì„¸ìš”.</h2>
                    <p class="mt-4 text-lg text-gray-600">ì§€ê¸ˆ ì´ë©”ì¼ì„ ë“±ë¡í•˜ì‹œë©´, Artb ëŸ°ì¹­ ì‹œ ê°€ì¥ ë¨¼ì € ì•Œë ¤ë“œë¦¬ê³  íŠ¹ë³„í•œ í• ì¸ í˜œíƒì„ ë“œë¦½ë‹ˆë‹¤.</p>
                    <form id="preregister-form" class="mt-8 flex flex-col sm:flex-row gap-4 max-w-lg mx-auto">
                        <input type="email" name="email" placeholder="ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" class="flex-grow w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
                        <button type="submit" class="bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition">ì‚¬ì „ ë“±ë¡í•˜ê¸°</button>
                    </form>
                </div>
                <div id="cta-thanks" class="hidden text-center bg-emerald-100 p-8 rounded-lg border border-emerald-300">
                    <h3 class="text-2xl font-bold text-emerald-800">ì‚¬ì „ ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h3>
                    <p class="mt-2 text-emerald-700">Artbì˜ ìƒˆë¡œìš´ ì†Œì‹ì„ ê°€ì¥ ë¨¼ì € ì•Œë ¤ë“œë¦´ê²Œìš”.</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white">
        <div class="max-w-6xl mx-auto py-8 px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-lg font-bold">Artb</p>
            <p class="mt-2 text-gray-400">&copy; 2025 Artb. All rights reserved. AIì™€ í•¨ê»˜í•˜ëŠ” ë¯¸ìˆ  êµìœ¡ì˜ ìƒˆë¡œìš´ ê¸°ì¤€.</p>
        </div>
    </footer>

    <!-- Correction Choice Modal -->
    <div id="correction-choice-modal" class="modal-backdrop hidden">
        <div class="modal-content text-center">
            <h3 class="text-2xl font-bold mb-4">ì–´ë–¤ ì´ë¯¸ì§€ë¡œ ë¶„ì„í• ê¹Œìš”?</h3>
            <p class="text-gray-600 mb-6">AIê°€ ì™œê³¡ì„ ìë™ ë³´ì •í–ˆìŠµë‹ˆë‹¤. ì›ë³¸ê³¼ ë³´ì •ë³¸ ì¤‘ ë¶„ì„ì— ì‚¬ìš©í•  ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                <div>
                    <h4 class="font-semibold mb-2">ì›ë³¸ ì´ë¯¸ì§€</h4>
                    <img id="choice-original-image" class="w-full h-auto rounded-md border" />
                </div>
                <div>
                    <h4 class="font-semibold mb-2">ë³´ì •ëœ ì´ë¯¸ì§€</h4>
                    <img id="choice-corrected-image" class="w-full h-auto rounded-md border" />
                </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <button id="analyze-original-btn" class="w-full bg-gray-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-600 transition">ì›ë³¸ìœ¼ë¡œ ë¶„ì„</button>
                <button id="analyze-corrected-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition">ë³´ì •ë³¸ìœ¼ë¡œ ë¶„ì„</button>
            </div>
        </div>
    </div>
    
    <!-- AI Feedback Progress Modal -->
    <div id="feedback-progress-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h3 class="text-2xl font-bold mb-6 text-center">AIê°€ ê·¸ë¦¼ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤</h3>
            <div class="space-y-4">
                <div id="step1" class="progress-step pending">
                    <div class="icon">ğŸ–¼ï¸</div><p>AI ë¶„ì„ ìš”ì²­</p>
                </div>
                <div id="step2" class="progress-step pending">
                    <div class="icon">ğŸ§ </div><p>êµ¬ë„ ë° í˜•íƒœ í‰ê°€</p>
                </div>
                <div id="step3" class="progress-step pending">
                    <div class="icon">ğŸ¨</div><p>ëª…ì•” ë° ì±„ìƒ‰ í‰ê°€</p>
                </div>
                <div id="step4" class="progress-step pending">
                    <div class="icon">âœï¸</div><p>ìµœì¢… í”¼ë“œë°± ìƒì„±</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ==== ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ (WebWorker + OpenCV.js ë¶„ë¦¬, ëª¨ë°”ì¼ ìš°ì„ ) ==== -->
    <script>
    /* =========================
       Mobile-first + Worker/OpenCV ë¶„ë¦¬ ì ìš©
       ========================= */

    /** ---------- ê³µìš© DOM ---------- **/
    const backendUrl = 'https://artb-backend.vercel.app';

    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu       = document.getElementById('mobile-menu');

    const startCameraButton = document.getElementById('startCameraButton');
    const cameraView        = document.getElementById('camera-view');
    const videoElement      = document.getElementById('videoElement');
    const canvasOverlay     = document.getElementById('canvasOverlay');
    const captureButton     = document.getElementById('captureButton');
    const closeCameraButton = document.getElementById('closeCameraButton');
    const cameraError       = document.getElementById('camera-error');

    const uploadImageButton = document.getElementById('uploadImageButton');
    const imageFileInput    = document.getElementById('imageFileInput');
    const dropzone          = document.getElementById('dropzone');

    const resultSection     = document.getElementById('result-section');
    const processedImageEl  = document.getElementById('processedImage');

    const correctionChoiceModal = document.getElementById('correction-choice-modal');
    const choiceOriginalImageEl = document.getElementById('choice-original-image');
    the_choiceCorrectedImageEl   = document.getElementById('choice-corrected-image');
    const analyzeOriginalBtn    = document.getElementById('analyze-original-btn');
    const analyzeCorrectedBtn   = document.getElementById('analyze-corrected-btn');

    const feedbackProgressModal = document.getElementById('feedback-progress-modal');
    const progressSteps = {
      step1: document.getElementById('step1'),
      step2: document.getElementById('step2'),
      step3: document.getElementById('step3'),
      step4: document.getElementById('step4'),
    };

    const styleAnalysisButton = document.getElementById('styleAnalysisButton');
    const styleLoading        = document.getElementById('style-loading');
    const styleResult         = document.getElementById('style-result');
    const styleResultText     = document.getElementById('style-result-text');

    const dpr = Math.max(1, window.devicePixelRatio || 1);

    /** ---------- ìƒíƒœ ---------- **/
    let stream = null;
    let lastPreviewBitmap = null;     // ì˜¤ë²„ë ˆì´ ê·¸ë¦´ ë•Œ ì“°ëŠ” í˜„ì¬ í”„ë¦¬ë·°
    let lastFullBitmap    = null;     // ì›Œì»¤ ë³´ì •ìš© ì›ë³¸ í”„ë ˆì„
    let lastDetected      = null;     // { corners: [[x,y]...], viewW, viewH, fullW, fullH }
    let lastImageBlob     = null;     // ë¶„ì„ì— ì‹¤ì œ ë³´ë‚¸ ì´ë¯¸ì§€ blob (ì›ë³¸/ë³´ì •ë³¸ ì¤‘ ì‚¬ìš©ìê°€ ì„ íƒí•œ ê²ƒ)
    let originalImageBlob = null;     // ëª¨ë‹¬ í‘œì‹œìš©
    let correctedImageBlob= null;     // ëª¨ë‹¬ í‘œì‹œìš©
    let previewSendPending = false;   // í”„ë¦¬ë·° ë¹„íŠ¸ë§µ ì „ì†¡ ì¤‘ì¸ ê²½ìš° ì¤‘ë³µ ì „ì†¡ ì œí•œ

    /** ---------- ì›Œì»¤ ì´ˆê¸°í™” ---------- **/
    const workerURL = URL.createObjectURL(new Blob([WORKER_SRC()], { type: 'application/javascript' }));
    const cvWorker = new Worker(workerURL);
    cvWorker.onmessage = (ev) => {
      const m = ev.data;
      if (m.type === 'status') {
        if (m.level === 'error') showError(m.text);
      } else if (m.type === 'detected') {
        // ê°ì§€ ê²°ê³¼(ì½”ë„ˆ/ìŠ¤ì¼€ì¼) ìˆ˜ì‹  â†’ ì˜¤ë²„ë ˆì´ ê·¸ë¦¬ê¸°
        lastDetected = m;
        drawOverlayFromDetection(m);
      } else if (m.type === 'correctedBlob') {
        // ë³´ì •ë³¸ ê²°ê³¼ ìˆ˜ì‹  â†’ ëª¨ë‹¬ ì¸ë„¤ì¼/ë¶„ì„ìš©ìœ¼ë¡œ ì‚¬ìš©
        correctedImageBlob = m.blob;
        const url = URL.createObjectURL(correctedImageBlob);
        choiceCorrectedImageEl.src = url;
        // ì˜¤ë¦¬ì§€ë„ì´ ì¤€ë¹„ë˜ì–´ ìˆìœ¼ë©´ ëª¨ë‹¬ ë…¸ì¶œ
        if (choiceOriginalImageEl.src) {
          correctionChoiceModal.classList.remove('hidden');
        }
      }
    };

    /** ---------- ëª¨ë°”ì¼ ë©”ë‰´ ---------- **/
    mobileMenuButton?.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });
    document.querySelectorAll('.mobile-menu-link')?.forEach(el => {
      el.addEventListener('click', () => mobileMenu.classList.add('hidden'));
    });

    /** ---------- ìœ í‹¸ ---------- **/
    function showError(msg) {
      cameraError.textContent = msg;
      cameraError.classList.remove('hidden');
    }
    function hideError() { cameraError.classList.add('hidden'); }
    function isMobile() { return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent); }

    function fitWithin(w,h,mw,mh){ const s=Math.min(mw/w, mh/h); return {w:Math.round(w*s), h:Math.round(h*s)}; }

    function drawOverlayFromDetection(det) {
      // det: { corners: [[x,y]...], viewW, viewH }
      const ctx = canvasOverlay.getContext('2d');
      ctx.clearRect(0,0,canvasOverlay.width, canvasOverlay.height);
      if (!det?.corners || det.corners.length < 3) return;

      // ìº”ë²„ìŠ¤ ë¦¬ì‚¬ì´ì¦ˆ (videoë‚˜ ì—…ë¡œë“œ í”„ë¦¬ë·° ë°•ìŠ¤ í¬ê¸°ì— ë§ì¶¤)
      const vw = det.viewW, vh = det.viewH;
      if (canvasOverlay.width !== vw || canvasOverlay.height !== vh) {
        canvasOverlay.width = vw; canvasOverlay.height = vh;
      }
      const poly = det.corners;

      // 50% ì˜¤ë²„ë ˆì´ + êµµì€ ì„ /ì (ëª¨ë°”ì¼ í•«ì¡´)
      ctx.fillStyle = 'rgba(22,163,74,0.45)';
      ctx.beginPath();
      ctx.moveTo(poly[0][0], poly[0][1]);
      for (let i=1;i<poly.length;i++) ctx.lineTo(poly[i][0], poly[i][1]);
      ctx.closePath(); ctx.fill();

      ctx.strokeStyle = '#ff3333'; ctx.lineWidth = 3*dpr;
      ctx.beginPath();
      ctx.moveTo(poly[0][0], poly[0][1]);
      for (let i=1;i<poly.length;i++) ctx.lineTo(poly[i][0], poly[i][1]);
      ctx.closePath(); ctx.stroke();

      ctx.fillStyle = '#ff3333';
      for (const [x,y] of poly) { ctx.beginPath(); ctx.arc(x,y, 8*dpr, 0, Math.PI*2); ctx.fill(); }
    }

    /** ---------- ì—…ë¡œë“œ íë¦„ ---------- **/
    uploadImageButton.addEventListener('click', () => {
      imageFileInput?.removeAttribute('capture');  // ëª¨ë°”ì¼ì—ì„œë„ ê°¤ëŸ¬ë¦¬ë¡œ
      imageFileInput?.click();
    });
    imageFileInput.addEventListener('change', async (e) => {
      const file = e.target.files?.[0];
      imageFileInput.value = '';
      if (!file) return;
      hideError();
      resultSection.classList.add('hidden');

      // ì›ë³¸ ì´ë¯¸ì§€ ë¹„íŠ¸ë§µ/Blob ì¤€ë¹„
      let fullBM = null;
      try {
        fullBM = await toImageBitmap(file);
      } catch {
        showError('ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        return;
      }
      originalImageBlob = file;

      // í”„ë¦¬ë·° ìº”ë²„ìŠ¤ ì˜ì—­ í¬ê¸° ê³„ì‚° (ì»¨í…Œì´ë„ˆ í­ ê¸°ì¤€ 1280x720 ë‚´)
      const fit = fitWithin(fullBM.width, fullBM.height, 1280, 720);
      // ì›Œì»¤ë¡œ "ì •ì  ì´ë¯¸ì§€ ê°ì§€" ìš”ì²­
      cvWorker.postMessage({ type: 'sourceStill', full: fullBM, viewW: fit.w, viewH: fit.h }, [fullBM]);

      // ëª¨ë‹¬ì˜ ì›ë³¸ ì¸ë„¤ì¼
      const origURL = URL.createObjectURL(file);
      choiceOriginalImageEl.src = origURL;

      // ê°ì§€ ë˜ë©´ ì›Œì»¤ê°€ ìë™ìœ¼ë¡œ ë³´ì •ë³¸ Blobë„ ë³´ë‚´ì¤€ë‹¤(correctedBlob)
      // â†’ correctedImageBlob ì„¸íŒ… + ëª¨ë‹¬ ì˜¤í”ˆ
    });

    /** ---------- ì¹´ë©”ë¼ íë¦„ ---------- **/
    startCameraButton.addEventListener('click', async () => {
      hideError();
      resultSection.classList.add('hidden');

      try {
        if (location.protocol !== 'https:' || !navigator.mediaDevices) {
          throw new Error('ì¹´ë©”ë¼ëŠ” HTTPS í˜ì´ì§€ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        }
        if (stream) stream.getTracks().forEach(t => t.stop());

        stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } },
          audio: false
        });

        cameraView.classList.remove('hidden');
        startCameraButton.textContent = 'ì¹´ë©”ë¼ ì¬ì‹œì‘';
        videoElement.srcObject = stream;
        videoElement.onloadedmetadata = () => {
          // ë¹„ë””ì˜¤ í”„ë¦¬ë·° í¬ê¸°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì˜¤ë²„ë ˆì´ ë™ê¸°í™”
          syncOverlayToVideo();
          // ì›Œì»¤ì— í”„ë ˆì„ ì „ì†¡ ë£¨í”„ ì‹œì‘
          startVideoLoop();
        };
      } catch (err) {
        console.error(err);
        showError(err.message || 'ì¹´ë©”ë¼ ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”.');
        cameraView.classList.add('hidden');
        if (isMobile()) {
          // ëª¨ë°”ì¼ í´ë°±: ë„¤ì´í‹°ë¸Œ ì¹´ë©”ë¼(ì´¬ì˜ í›„ íŒŒì¼ ë°˜í™˜)
          imageFileInput.setAttribute('capture', 'environment');
          imageFileInput.click();
          setTimeout(() => imageFileInput.removeAttribute('capture'), 0);
        }
      }
    });

    function syncOverlayToVideo() {
      const r = videoElement.getBoundingClientRect();
      canvasOverlay.width  = Math.round(r.width);
      canvasOverlay.height = Math.round(r.height);
    }
    window.addEventListener('resize', syncOverlayToVideo);

    async function startVideoLoop() {
      if (!stream?.active) return;
      try {
        const vw = videoElement.videoWidth, vh = videoElement.videoHeight;
        if (!vw || !vh) { requestAnimationFrame(startVideoLoop); return; }
        const fit = fitWithin(vw, vh, 1280, 720);

        // í”„ë¦¬ë·° ìº”ë²„ìŠ¤ â†’ ë¹„íŠ¸ë§µ
        const prevCanvas = document.createElement('canvas');
        prevCanvas.width = fit.w; prevCanvas.height = fit.h;
        prevCanvas.getContext('2d').drawImage(videoElement, 0, 0, fit.w, fit.h);
        const previewBM = await createImageBitmap(prevCanvas);

        // í’€ í”„ë ˆì„ ë¹„íŠ¸ë§µ
        const fullBM = await createImageBitmap(videoElement);

        lastPreviewBitmap = previewBM;
        lastFullBitmap    = fullBM;

        if (!previewSendPending) {
          previewSendPending = true;
          cvWorker.postMessage({ type: 'sourceFrame', preview: previewBM, full: fullBM, viewW: fit.w, viewH: fit.h, fullW: vw, fullH: vh }, [previewBM, fullBM]);
          previewSendPending = false;
        }
      } catch (e) {
        console.warn('preview send skipped:', e);
      }
      requestAnimationFrame(startVideoLoop);
    }

    captureButton.addEventListener('click', async () => {
      // í˜„ì¬ í”„ë ˆì„ì˜ ì›ë³¸ì„ Blobìœ¼ë¡œ
      if (!lastFullBitmap) return;
      const snapCanvas = document.createElement('canvas');
      snapCanvas.width = lastFullBitmap.width; snapCanvas.height = lastFullBitmap.height;
      const ctx = snapCanvas.getContext('2d');
      ctx.drawImage(lastFullBitmap, 0, 0);
      originalImageBlob = await snapCanvas.convertToBlob({ type:'image/jpeg', quality:0.92 });

      // ê°ì§€ëœ ì½”ë„ˆë¡œ ì›Œì»¤ì— â€œì§€ê¸ˆ ë³´ì •í•´ì¤˜â€ ìš”ì²­
      cvWorker.postMessage({ type:'rectifyNow' });

      // ì›ë³¸ ì¸ë„¤ì¼ ì¤€ë¹„ ë° ëª¨ë‹¬ ì˜¤í”ˆ ì¤€ë¹„
      choiceOriginalImageEl.src = URL.createObjectURL(originalImageBlob);
      // correctedImageBlobì€ ì›Œì»¤ì—ì„œ ì˜¤ë©´(choiceCorrectedImageEl.src ì„¸íŒ…) ëª¨ë‹¬ ì˜¤í”ˆ
    });

    closeCameraButton.addEventListener('click', () => {
      if (stream) stream.getTracks().forEach(t => t.stop());
      cameraView.classList.add('hidden');
      cameraError.classList.add('hidden');
      startCameraButton.textContent = 'ì¹´ë©”ë¼ë¡œ ì‘í’ˆ ì´¬ì˜í•˜ê¸°';
    });

    /** ---------- ë³´ì • ì„ íƒ ëª¨ë‹¬ â†’ ë¶„ì„ ---------- **/
    analyzeOriginalBtn.addEventListener('click', () => startAiAnalysis(originalImageBlob));
    analyzeCorrectedBtn.addEventListener('click', () => startAiAnalysis(correctedImageBlob));

    function updateProgressStep(stepId, status, text) {
      const step = progressSteps[stepId]; if (!step) return;
      step.className = 'progress-step ' + status;
      step.querySelector('p').textContent = text;
    }
    async function startAiAnalysis(imageBlob) {
      correctionChoiceModal.classList.add('hidden');
      feedbackProgressModal.classList.remove('hidden');
      Object.values(progressSteps).forEach(step => step.className = 'progress-step pending');
      setTimeout(() => updateProgressStep('step1','active','AI ë¶„ì„ ìš”ì²­'), 80);
      submitForAnalysis(imageBlob);
    }

    async function submitForAnalysis(imageBlob) {
      lastImageBlob = imageBlob;
      updateProgressStep('step1','completed','AI ë¶„ì„ ìš”ì²­ ì™„ë£Œ');
      setTimeout(() => updateProgressStep('step2','active','êµ¬ë„ ë° í˜•íƒœ í‰ê°€'), 150);

      const formData = new FormData();
      formData.append('image', imageBlob, 'artwork.jpg');

      try {
        const res = await fetch(\`\${backendUrl}/analyze\`, { method:'POST', body: formData });
        if (!res.ok) throw new Error(\`ì„œë²„ ì˜¤ë¥˜: \${res.statusText}\`);
        const result = await res.json();

        updateProgressStep('step2','completed','êµ¬ë„ ë° í˜•íƒœ í‰ê°€ ì™„ë£Œ');
        setTimeout(()=>updateProgressStep('step3','active','ëª…ì•” ë° ì±„ìƒ‰ í‰ê°€'), 300);
        setTimeout(()=>updateProgressStep('step3','completed','ëª…ì•” ë° ì±„ìƒ‰ í‰ê°€ ì™„ë£Œ'), 900);
        setTimeout(()=>updateProgressStep('step4','active','ìµœì¢… í”¼ë“œë°± ìƒì„±'), 1200);

        setTimeout(() => {
          updateProgressStep('step4','completed','ìµœì¢… í”¼ë“œë°± ìƒì„± ì™„ë£Œ!');
          setTimeout(() => {
            feedbackProgressModal.classList.add('hidden');
            displayResults({
              processed_image_url: URL.createObjectURL(imageBlob),
              ai_feedback: { feedback_text: result.feedback }
            });
          }, 300);
        }, 1600);
      } catch (err) {
        feedbackProgressModal.classList.add('hidden');
        console.error(err);
        showError('AI ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }
    }

    function formatFeedbackToHtml(text) {
      const sections = text.split(/###\s*(.*?)\s*\n/g).filter(s => s.trim() !== '');
      let html = '';
      for (let i = 0; i < sections.length; i += 2) {
        const title = sections[i].replace(/:/g,'');
        const content = sections[i+1].replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').trim();
        html += \`<div class="feedback-section mb-4"><h4>\${title}</h4><p>\${content}</p></div>\`;
      }
      return html;
    }
    function displayResults(data) {
      resultSection.classList.remove('hidden');
      processedImageEl.src = data.processed_image_url;
      document.getElementById('ai-feedback-text').innerHTML = formatFeedbackToHtml(data.ai_feedback.feedback_text);
      document.getElementById('style-analysis-container').classList.remove('hidden');
      document.getElementById('style-result').classList.add('hidden');
    }

    /** ---------- ë“œë¡­ì¡´ / ì„¤ë¬¸ / ë¬¸ì˜ / ì‚¬ì „ë“±ë¡: ê¸°ì¡´ ë¡œì§ ìœ ì§€ ---------- **/
    ['dragenter','dragover'].forEach(evt => dropzone.addEventListener(evt, e => { e.preventDefault(); e.stopPropagation(); dropzone.classList.add('dragover'); }));
    ['dragleave','drop'].forEach(evt => dropzone.addEventListener(evt, e => { e.preventDefault(); e.stopPropagation(); dropzone.classList.remove('dragover'); }));
    dropzone.addEventListener('drop', async (e) => {
      const file = e.dataTransfer?.files?.[0]; if (file) {
        imageFileInput.files = e.dataTransfer.files; // ì¬ì‚¬ìš©
        const ev = new Event('change'); imageFileInput.dispatchEvent(ev);
      }
    });

    const surveyForm = document.getElementById('artb-survey-form');
    const surveyContainer = document.getElementById('survey-container');
    const surveyThanks = document.getElementById('survey-thanks');
    if (surveyForm) {
      surveyForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const fd = new FormData(surveyForm);
        const data = { role: fd.get('role'), interests: fd.getAll('interest'), feedback_text: fd.get('feedback_text') };
        try {
          const res = await fetch(\`\${backendUrl}/survey\`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data) });
          if (!res.ok) throw new Error('ì„œë²„ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          surveyContainer.classList.add('hidden'); surveyThanks.classList.remove('hidden');
        } catch (err) { console.error(err); alert('ì„¤ë¬¸ ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'); }
      });
    }

    const contactForm = document.getElementById('contact-form');
    const contactContainer = document.getElementById('contact-container');
    const contactThanks = document.getElementById('contact-thanks');
    if (contactForm) {
      contactForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const fd = new FormData(contactForm);
        const data = Object.fromEntries(fd.entries());
        try {
          const res = await fetch(\`\${backendUrl}/contact\`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data) });
          if (!res.ok) throw new Error('ë¬¸ì˜ ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          contactContainer.classList.add('hidden'); contactThanks.classList.remove('hidden');
        } catch (err) { console.error(err); alert(err.message); }
      });
    }

    const preregisterForm = document.getElementById('preregister-form');
    const ctaContainer = document.getElementById('cta-container');
    const ctaThanks = document.getElementById('cta-thanks');
    if (preregisterForm) {
      preregisterForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const fd = new FormData(preregisterForm);
        const data = Object.fromEntries(fd.entries());
        try {
          const res = await fetch(\`\${backendUrl}/preregister\`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data) });
          if (!res.ok) throw new Error('ì‚¬ì „ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          ctaContainer.classList.add('hidden'); ctaThanks.classList.remove('hidden');
        } catch (err) { console.error(err); alert(err.message); }
      });
    }

    /** ---------- ë³´ì¡° ìœ í‹¸ ---------- **/
    async function toImageBitmap(fileOrCanvasOrVideo) {
      if (fileOrCanvasOrVideo instanceof Blob) {
        return await createImageBitmap(fileOrCanvasOrVideo);
      }
      return await createImageBitmap(fileOrCanvasOrVideo);
    }

    /** ---------- ì›Œì»¤ ì†ŒìŠ¤ (OpenCV.js ë¡œë“œ & ì²˜ë¦¬ ì „ë‹´) ---------- **/
    function WORKER_SRC(){ return \`
let cvReady = false;
let lastPreview = null; // ImageBitmap(ì¶•ì†Œ)
let lastFull    = null; // ImageBitmap(ì›ë³¸)
let viewW=0, viewH=0, fullW=0, fullH=0;
let lastCorners = null;

// OpenCV.js ë¡œë“œ
self.importScripts('https://docs.opencv.org/4.x/opencv.js');
cv['onRuntimeInitialized'] = ()=>{ cvReady = true; postStatus('ok','OpenCV ready'); };

function postStatus(level,text){ self.postMessage({type:'status', level, text}); }
function postDetected(corners){ self.postMessage({type:'detected', corners, viewW, viewH, fullW, fullH}); }

self.onmessage = async (ev)=>{
  const m = ev.data;
  if (m.type === 'sourceStill') {
    // ì—…ë¡œë“œ ì •ì§€ ì´ë¯¸ì§€
    lastFull = m.full; viewW = m.viewW; viewH = m.viewH; fullW = m.full.width; fullH = m.full.height;
    // ë¯¸ë¦¬ë³´ê¸° ìƒì„±
    const prev = new OffscreenCanvas(viewW, viewH);
    prev.getContext('2d').drawImage(lastFull, 0,0, viewW, viewH);
    lastPreview = prev.transferToImageBitmap();

    await detectOnPreview();
    // ê°ì§€ ì„±ê³µ ì‹œ ë°”ë¡œ ë³´ì •ë³¸ê¹Œì§€ ë§Œë“¤ì–´ Blobìœ¼ë¡œ ì „ë‹¬(ëª¨ë‹¬ì—ì„œ ì¦‰ì‹œ ë¹„êµ ê°€ëŠ¥)
    if (lastCorners && lastCorners.length===4) {
      const blob = await rectifyToBlob(lastCorners);
      self.postMessage({ type:'correctedBlob', blob });
    }
  } else if (m.type === 'sourceFrame') {
    // ì¹´ë©”ë¼ í”„ë ˆì„
    lastPreview = m.preview; lastFull = m.full;
    viewW = m.viewW; viewH = m.viewH; fullW = m.fullW || m.full.width; fullH = m.fullH || m.full.height;
    await detectOnPreview();
  } else if (m.type === 'rectifyNow') {
    if (!lastCorners || !lastFull) return;
    const blob = await rectifyToBlob(lastCorners);
    self.postMessage({ type:'correctedBlob', blob });
  }
};

async function detectOnPreview(){
  if (!cvReady || !lastPreview) return;
  try{
    const c = new OffscreenCanvas(viewW, viewH);
    const cx = c.getContext('2d');
    cx.drawImage(lastPreview, 0,0, viewW, viewH);
    const mat = cv.imread(c);
    let gray=new cv.Mat(); cv.cvtColor(mat, gray, cv.COLOR_RGBA2GRAY);
    let blur=new cv.Mat(); cv.GaussianBlur(gray, blur, new cv.Size(5,5), 0);
    let edges=new cv.Mat(); cv.Canny(blur, edges, 60, 180);
    let contours=new cv.MatVector(), hier=new cv.Mat();
    cv.findContours(edges, contours, hier, cv.RETR_EXTERNAL, cv.CHAIN_APPROX_SIMPLE);

    let best=null, bestArea=0, minArea=(viewW*viewH)/10;
    for(let i=0;i<contours.size();i++){
      let cnt=contours.get(i); let area=cv.contourArea(cnt);
      if(area>minArea){
        let peri=cv.arcLength(cnt,true);
        let approx=new cv.Mat(); cv.approxPolyDP(cnt, approx, 0.02*peri, true);
        if(approx.rows===4 && cv.isContourConvex(approx)){
          if(area>bestArea){ bestArea=area; if(best) best.delete(); best=approx.clone(); }
        }
        approx.delete(); cnt.delete();
      }else{ cnt.delete(); }
    }
    let corners=null;
    if(best){
      corners=[];
      for(let i=0;i<4;i++){ corners.push([best.intPtr(i,0)[0], best.intPtr(i,0)[1]]); }
      corners = orderCW(corners);
      best.delete();
    }
    gray.delete(); blur.delete(); edges.delete(); contours.delete(); hier.delete(); mat.delete();

    lastCorners = corners;
    if(corners) postDetected(corners);
    else postDetected([]); // ì˜¤ë²„ë ˆì´ ì´ˆê¸°í™”
  }catch(e){
    postStatus('error','detect failed: '+e.message);
  }
}

function orderCW(pts){
  const c=pts.reduce((a,[x,y])=>[a[0]+x,a[1]+y],[0,0]).map(v=>v/pts.length);
  const arr=pts.map(p=>({p,ang:Math.atan2(p[1]-c[1], p[0]-c[0])})).sort((a,b)=>a.ang-b.ang).map(o=>o.p);
  // CCWì´ë©´ ë’¤ì§‘ì–´ì„œ CW
  const area = signedArea(arr);
  return (area>0) ? arr.reverse() : arr;
}
function signedArea(poly){
  let s=0; for(let i=0;i<poly.length;i++){
    const [x1,y1]=poly[i], [x2,y2]=poly[(i+1)%poly.length]; s += (x1*y2 - x2*y1);
  } return 0.5*s;
}

// preview ì½”ë„ˆ â†’ full ì¢Œí‘œë¡œ ìŠ¤ì¼€ì¼ í›„ í˜¸ëª¨ê·¸ë˜í”¼, Blob ë°˜í™˜
async function rectifyToBlob(cornersPreview){
  // ìŠ¤ì¼€ì¼ ì—…: preview â†’ full
  const sx = (lastFull.width  || fullW) / viewW;
  const sy = (lastFull.height || fullH) / viewH;
  const q = cornersPreview.map(([x,y])=> [x*sx, y*sy]);

  // ëª©ì ì§€ í¬ê¸°: ì›ë³¸ ì¢…íš¡ë¹„ ìœ ì§€(ê°€ë¡œ/ì„¸ë¡œ íŒì •)
  const bbox = (()=>{ let minx=1e9,miny=1e9,maxx=-1e9,maxy=-1e9;
    for(const [x,y] of q){ if(x<minx)minx=x; if(y<miny)miny=y; if(x>maxx)maxx=x; if(y>maxy)maxy=y; }
    return {w:maxx-minx, h:maxy-miny};
  })();
  let targetW, targetH;
  if (bbox.w >= bbox.h){ targetW = 1000; targetH = Math.round(1000*(bbox.h/(bbox.w||1))); }
  else { targetH = 1000; targetW = Math.round(1000*(bbox.w/(bbox.h||1))); }

  // lastFull â†’ Mat
  const cFull = new OffscreenCanvas(lastFull.width, lastFull.height);
  const cx = cFull.getContext('2d'); cx.drawImage(lastFull, 0,0);
  const src = cv.imread(cFull);

  // í˜¸ëª¨ê·¸ë˜í”¼
  const src4 = cv.matFromArray(4,1, cv.CV_32FC2, new Float32Array(q.flat()));
  const dst4 = cv.matFromArray(4,1, cv.CV_32FC2, new Float32Array([0,0, targetW-1,0, targetW-1,targetH-1, 0,targetH-1]));
  const Hm = cv.getPerspectiveTransform(src4, dst4);
  const out = new cv.Mat();
  cv.warpPerspective(src, out, Hm, new cv.Size(targetW, targetH), cv.INTER_LINEAR, cv.BORDER_REFLECT);

  // Mat â†’ Blob
  const canvasOut = new OffscreenCanvas(targetW, targetH);
  cv.imshow(canvasOut, out);
  const blob = await canvasOut.convertToBlob({ type:'image/jpeg', quality:0.92 });

  // clean
  src.delete(); src4.delete(); dst4.delete(); Hm.delete(); out.delete();
  return blob;
}
\`;}
    </script>
</body>
</html>
